// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// to sync schema:> npx migrate dev --name <migration-name>

// list of update history listed at the end of this file

// to update Prisma.Client:> npx prisma generate

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Users {
  id            String         @id @default(uuid())
  email         String         @unique
  name          String
  phone         String?
  requestedRole enumRole?      @default(guest)
  role          enumRole       @default(guest)
  isActive      Boolean        @default(false)
  regApproval   enumApproval   @default(pending)
  salt          String?
  password      String
  createdAt     DateTime       @default(now())
  createdBy     String
  updatedAt     DateTime?      @updatedAt
  updatedBy     String?
  deleted       DateTime?
  deletedBy     String?
  Procurement1  Procurements[] @relation("createdByUserId")
  Procurement2  Procurements[] @relation("updatedByUserId")
  Procurement3  Procurements[] @relation("deletedByUserId")
  Sales1        Sales[]        @relation("createdByUserId")
  Sales2        Sales[]        @relation("updatedByUserId")
  Sales3        Sales[]        @relation("deletedByUserId")
  Customer      Customers[]    @relation("userId")
  Customer1     Customers[]    @relation("createdByUserId")
  Customer2     Customers[]    @relation("updatedByUserId")
  Customer3     Customers[]    @relation("deletedByUserId")
  Supplier      Suppliers[]    @relation("userId")
  Supplier1     Suppliers[]    @relation("createdByUserId")
  Supplier2     Suppliers[]    @relation("updatedByUserId")
  Supplier3     Suppliers[]    @relation("deletedByUserId")
  Product1      Products[]     @relation("createdByUserId")
  Product2      Products[]     @relation("updatedByUserId")
  Product3      Products[]     @relation("deletedByUserId")
  Shipper       Shippers[]     @relation("userId")
  Shipper1      Shippers[]     @relation("createdByUserId")
  Shipper2      Shippers[]     @relation("updatedByUserId")
  Shipper3      Shippers[]     @relation("deletedByUserId")
  Token         Tokens[]       @relation("userId")

  @@index([id, email])
}

model Tokens {
  refreshToken String @id @unique
  userId       String
  User         Users  @relation("userId", fields: [userId], references: [id])

  @@index([refreshToken])
}

model Procurements {
  id          Int                @id @default(autoincrement())
  sqc         Int                @default(1)
  transaction enumProcurementTrx
  supplierId  Int
  productId   Int
  quantityKg  Int
  unitPrice   Decimal
  stockTo     String //Allocation
  trxStatus   enumProcurementSta
  createdAt   DateTime           @default(now())
  createdBy   String
  updatedAt   DateTime?          @updatedAt
  updatedBy   String?
  deleted     DateTime?
  deletedBy   String?
  User1       Users              @relation("createdByUserId", fields: [createdBy], references: [id])
  User2       Users?             @relation("updatedByUserId", fields: [updatedBy], references: [id])
  User3       Users?             @relation("deletedByUserId", fields: [deletedBy], references: [id])
  Supplier    Suppliers          @relation(fields: [supplierId], references: [id])
  Product     Products           @relation(fields: [productId], references: [id])
}

model Sales {
  id         Int          @id @default(autoincrement())
  sqc        Int          @default(1)
  salesDate  DateTime
  customerId Int
  productId  Int
  quantityKg Int
  soldprice  Decimal
  stockOf    String //Allocation
  trxStatus  enumSalesSta
  createdAt  DateTime     @default(now())
  createdBy  String
  updatedAt  DateTime?    @updatedAt
  updatedBy  String?
  deleted    DateTime?
  deletedBy  String?
  Customer   Customers    @relation(fields: [customerId], references: [id])
  Product    Products     @relation(fields: [productId], references: [id])
  User1      Users        @relation("createdByUserId", fields: [createdBy], references: [id])
  User2      Users?       @relation("updatedByUserId", fields: [updatedBy], references: [id])
  User3      Users?       @relation("deletedByUserId", fields: [deletedBy], references: [id])
}

model Customers {
  id          Int       @id @default(autoincrement())
  userId      String?
  name        String
  phone       String?
  unloadPoint String?
  createdAt   DateTime  @default(now())
  createdBy   String
  updatedAt   DateTime? @updatedAt
  updatedBy   String?
  deleted     DateTime?
  deletedBy   String?
  User        Users?    @relation("userId", fields: [userId], references: [id])
  User1       Users     @relation("createdByUserId", fields: [createdBy], references: [id])
  User2       Users?    @relation("updatedByUserId", fields: [updatedBy], references: [id])
  User3       Users?    @relation("deletedByUserId", fields: [deletedBy], references: [id])
  Sales       Sales[]
}

enum enumRole {
  admin
  customer
  employee
  guest
  shipper
  supplier
}

enum enumApproval {
  approved
  denied
  pending
}

enum enumProcurementTrx {
  beli
  transfer
  pinjam
}

enum enumProcurementSta {
  po
  muat
  diterima
}

enum enumSalesSta {
  pesan
  proses
  muat
  diterima
}

model Suppliers {
  id          Int            @id @default(autoincrement())
  userId      String?
  name        String
  createdAt   DateTime       @default(now())
  createdBy   String
  updatedAt   DateTime?      @updatedAt
  updatedBy   String?
  deleted     DateTime?
  deletedBy   String?
  User        Users?         @relation("userId", fields: [userId], references: [id])
  User1       Users          @relation("createdByUserId", fields: [createdBy], references: [id])
  User2       Users?         @relation("updatedByUserId", fields: [updatedBy], references: [id])
  User3       Users?         @relation("deletedByUserId", fields: [deletedBy], references: [id])
  Procurement Procurements[]
}

model Products {
  id          Int            @id @default(autoincrement())
  alias       String
  name        String
  createdAt   DateTime       @default(now())
  createdBy   String
  updatedAt   DateTime?      @updatedAt
  updatedBy   String?
  deleted     DateTime?
  deletedBy   String?
  User1       Users          @relation("createdByUserId", fields: [createdBy], references: [id])
  User2       Users?         @relation("updatedByUserId", fields: [updatedBy], references: [id])
  User3       Users?         @relation("deletedByUserId", fields: [deletedBy], references: [id])
  Procurement Procurements[]
  Sales       Sales[]
}

model Shippers {
  id           Int       @id @default(autoincrement())
  userId       String?
  updatedBy    String?
  companyName  String
  contactName  String?
  contactPhone String?
  createdAt    DateTime  @default(now())
  createdBy    String
  updatedAt    DateTime? @updatedAt
  deleted      DateTime?
  deletedBy    String?
  User         Users?    @relation("userId", fields: [userId], references: [id])
  User1        Users     @relation("createdByUserId", fields: [createdBy], references: [id])
  User2        Users?    @relation("updatedByUserId", fields: [updatedBy], references: [id])
  User3        Users?    @relation("deletedByUserId", fields: [deletedBy], references: [id])
}

// MIGRATION UPDATE HISTORY

// MigrationName: 
// At-----------: 
// Description--: 
// 

// MigrationName: Move-refreshToken-to-Tokens-table
// At-----------: 20230512112143
// Description--: 
// delete refresToken field from users
// create Tokens table [refresToken @id @unique, userId]

// MigrationName: Add-userId-Add-Roles
// At-----------: 20230512052926
// Description--: 
// add deletedBy to users table in all tables
// add userId field in customers, shippers, suppliers and relation to users table
// add roles to enumRoles: shipper, supplier
// change all enum values to lowercase

// MigrationName: Edit-Users-RegistrationApproval
// At-----------: 20230508182756
// Description--: 
// add RegApproval in users table. default pending
// add enumApproval [approved, denied, pending]
// new user with pending approval can update registration in front page.
// approved user only can update registration in profile page.

// MigrationName: Edit-Users-phone
// At-----------: 20230508165210
// Description--: 
// add phone field in users table. Mandatory for admin, employee, customer role

// MigrationName: Edit-User-role
// At-----------: 20230508132047
// Description--: 
// add requestedRole fields in users table. Edit default to guest
// change enumRole from [ADMIN, USER] into [admin, customer, employee, guest]
